{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "md-editor",
  "type": "registry:ui",
  "title": "MdEditor",
  "description": "Markdown editor component using @uiw/react-md-editor. Note: Requires Next.js for dynamic imports.",
  "dependencies": [
    "@uiw/react-md-editor",
    "remark-gfm"
  ],
  "files": [
    {
      "path": "components/md-editor.tsx",
      "type": "registry:ui",
      "content": "\"use client\";\n\nimport dynamic from \"next/dynamic\";\nimport { useRef } from \"react\";\nimport remarkGfm from \"remark-gfm\";\nimport { Skeleton } from \"./skeleton\";\nimport {\n\tcropAndResizeImage,\n\tfileToBase64,\n\tvalidateImageFile,\n} from \"../lib/image-utils\";\nimport type { ICommand } from \"@uiw/react-md-editor\";\nimport { useAlert } from \"./alert\";\n\n// @ts-ignore\nimport \"@uiw/react-md-editor/markdown-editor.css\";\n// @ts-ignore\nimport \"@uiw/react-markdown-preview/markdown.css\";\n\nfunction EditorSkeleton() {\n\treturn (\n\t\t<div className=\"rounded-[6px] overflow-hidden border border-white/10 bg-[#272728] h-[420px] flex flex-col\">\n\t\t\t<div className=\"border-b border-white/10 p-2 h-10\">\n\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t<Skeleton className=\"h-6 w-16\" />\n\t\t\t\t\t<Skeleton className=\"h-6 w-12\" />\n\t\t\t\t\t<Skeleton className=\"h-6 w-10\" />\n\t\t\t\t\t<Skeleton className=\"h-6 w-20\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div className=\"p-3 space-y-2 flex-1\">\n\t\t\t\t<Skeleton className=\"h-4 w-3/4\" />\n\t\t\t\t<Skeleton className=\"h-4 w-1/2\" />\n\t\t\t\t<Skeleton className=\"h-4 w-2/3\" />\n\t\t\t\t<Skeleton className=\"h-4 w-5/6\" />\n\t\t\t\t<Skeleton className=\"h-4 w-4/6\" />\n\t\t\t\t<Skeleton className=\"h-4 w-2/3\" />\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nconst MDEditor = dynamic(() => import(\"@uiw/react-md-editor\"), {\n\tssr: false,\n\tloading: () => <EditorSkeleton />,\n});\n\ninterface MdEditorProps {\n\tvalue: string;\n\tonChange: (val: string) => void;\n\tplaceholder?: string;\n}\n\nexport function MdEditor({ value, onChange, placeholder }: MdEditorProps) {\n\tconst { showAlert } = useAlert();\n\tconst fileInputRef = useRef<HTMLInputElement>(null);\n\n\t// Custom image upload command\n\tconst imageUploadCommand: ICommand = {\n\t\tname: \"image-upload\",\n\t\tkeyCommand: \"image-upload\",\n\t\tbuttonProps: { \"aria-label\": \"Insert image\" },\n\t\ticon: (\n\t\t\t<svg width=\"12\" height=\"12\" viewBox=\"0 0 20 20\">\n\t\t\t\t<path\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\td=\"M15 9c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm4-7H1c-.55 0-1 .45-1 1v14c0 .55.45 1 1 1h18c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm-1 13l-6-5-2 2-4-5-4 8V4h16v11z\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t),\n\t\texecute: () => {\n\t\t\tfileInputRef.current?.click();\n\t\t},\n\t};\n\n\tconst handleImageUpload = async (\n\t\tevent: React.ChangeEvent<HTMLInputElement>,\n\t) => {\n\t\tconst file = event.target.files?.[0];\n\t\tif (!file) return;\n\n\t\t// Validate file\n\t\tconst validation = validateImageFile(file);\n\t\tif (!validation.valid) {\n\t\t\tshowAlert({\n\t\t\t\ttitle: \"Invalid Image\",\n\t\t\t\tmessage: validation.error || \"Please select a valid image file.\",\n\t\t\t\ttype: \"error\",\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\t// Convert to base64\n\t\t\tconst base64 = await fileToBase64(file);\n\n\t\t\t// Crop and resize\n\t\t\tconst resized = await cropAndResizeImage(base64, 800, 600, 0.85);\n\n\t\t\t// Get current cursor position or append to end\n\t\t\tconst textarea = document.querySelector(\n\t\t\t\t\"#md-editor textarea\",\n\t\t\t) as HTMLTextAreaElement;\n\t\t\tconst cursorPos = textarea?.selectionStart || value.length;\n\n\t\t\t// Insert markdown image syntax\n\t\t\tconst imageMarkdown = `\\n\\n![Image](${resized})\\n\\n`;\n\t\t\tconst newValue =\n\t\t\t\tvalue.slice(0, cursorPos) + imageMarkdown + value.slice(cursorPos);\n\n\t\t\tonChange(newValue);\n\n\t\t\t// Reset file input\n\t\t\tif (fileInputRef.current) {\n\t\t\t\tfileInputRef.current.value = \"\";\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error uploading image:\", error);\n\t\t\tshowAlert({\n\t\t\t\ttitle: \"Upload Failed\",\n\t\t\t\tmessage: \"Failed to upload image. Please try again.\",\n\t\t\t\ttype: \"error\",\n\t\t\t});\n\t\t}\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<input\n\t\t\t\tref={fileInputRef}\n\t\t\t\ttype=\"file\"\n\t\t\t\taccept=\"image/*\"\n\t\t\t\tonChange={handleImageUpload}\n\t\t\t\tclassName=\"hidden\"\n\t\t\t/>\n\t\t\t<div\n\t\t\t\tdata-color-mode=\"dark\"\n\t\t\t\tclassName=\"rounded-[6px] overflow-hidden border border-white/10 bg-white/5\"\n\t\t\t>\n\t\t\t\t<MDEditor\n\t\t\t\t\tid=\"md-editor\"\n\t\t\t\t\tvalue={value}\n\t\t\t\t\tonChange={(v) => onChange(v || \"\")}\n\t\t\t\t\tpreviewOptions={{ remarkPlugins: [remarkGfm] }}\n\t\t\t\t\ttextareaProps={{\n\t\t\t\t\t\tplaceholder:\n\t\t\t\t\t\t\tplaceholder || \"Write your post content in Markdown...\",\n\t\t\t\t\t}}\n\t\t\t\t\theight={466}\n\t\t\t\t\tclassName=\"rounded-2xl! overflow-hidden\"\n\t\t\t\t\textraCommands={[imageUploadCommand]}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</>\n\t);\n}\n"
    }
  ]
}