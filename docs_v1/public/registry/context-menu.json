{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "context-menu",
  "type": "registry:ui",
  "title": "ContextMenu",
  "description": "Right-click context menu component with typed menu items. Note: Requires Next.js for navigation features.",
  "dependencies": [
    "lucide-react",
    "motion"
  ],
  "registryDependencies": [
    "utils"
  ],
  "files": [
    {
      "path": "components/context-menu.tsx",
      "type": "registry:ui",
      "content": "\"use client\";\n\nimport { usePathname } from \"next/navigation\";\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport interface ContextMenuItem {\n\tlabel: string;\n\tonClick: () => void;\n\tshortcut?: string;\n\tdisabled?: boolean;\n\tseparator?: boolean;\n}\n\ninterface ContextMenuProps {\n\tchildren: React.ReactNode;\n\titems: ContextMenuItem[];\n\tclassName?: string;\n\ttrigger?: \"contextmenu\" | \"click\";\n}\n\nconst MENU_CONFIG = {\n\tWIDTH: 200,\n\tITEM_HEIGHT: 32,\n\tPADDING: 16,\n\tOFFSET: 10,\n};\n\nconst MENU_STYLES = {\n\tbase: \"text-white bg-[rgba(30,30,31,0.5)] backdrop-blur-xl shadow-[0px_20px_30px_0px_rgba(0,0,0,0.25),0px_0px_15px_0px_rgba(0,0,0,0.1),inset_0px_0px_0px_1px_rgba(255,255,255,0.075),0px_0px_0px_1px_rgba(0,0,0,0.5)]\",\n\tcontextMenu: \"fixed z-50 min-w-32 text-sm p-1 w-fit rounded-[6px]\",\n\tclickMenu:\n\t\t\"absolute left-0 top-full z-50 min-w-32 w-56 text-sm p-1 rounded-[6px] transition-all duration-150 ease-out\",\n\tmenuItem:\n\t\t\"w-full text-left px-1.5 py-1 transition-all duration-150 ease-out flex items-center justify-between rounded-[4px] truncate cursor-pointer whitespace-nowrap text-white/90\",\n\tmenuItemDisabled: \"text-white/40 cursor-not-allowed\",\n\tmenuItemEnabled: \"hover:bg-blue-600 focus:outline-hidden focus:ring-0\",\n};\n\nconst useMenuPosition = () => {\n\treturn useCallback((clientX: number, clientY: number, itemCount: number) => {\n\t\tconst menuHeight =\n\t\t\titemCount * MENU_CONFIG.ITEM_HEIGHT + MENU_CONFIG.PADDING;\n\t\tlet x = clientX;\n\t\tlet y = clientY;\n\n\t\tif (x + MENU_CONFIG.WIDTH > window.innerWidth) {\n\t\t\tx = window.innerWidth - MENU_CONFIG.WIDTH - MENU_CONFIG.OFFSET;\n\t\t}\n\t\tif (y + menuHeight > window.innerHeight) {\n\t\t\ty = window.innerHeight - menuHeight - MENU_CONFIG.OFFSET;\n\t\t}\n\n\t\treturn { x, y };\n\t}, []);\n};\n\nconst useClickOutside = (isOpen: boolean, onClose: () => void) => {\n\tconst ref = useRef<HTMLDivElement>(null);\n\n\tuseEffect(() => {\n\t\tif (!isOpen) return;\n\n\t\tconst handleMouseDown = (event: MouseEvent) => {\n\t\t\tif (ref.current && !ref.current.contains(event.target as Node)) {\n\t\t\t\tonClose();\n\t\t\t}\n\t\t};\n\n\t\tconst handleKeyDown = (event: KeyboardEvent) => {\n\t\t\tif (event.key === \"Escape\") onClose();\n\t\t};\n\n\t\tdocument.addEventListener(\"mousedown\", handleMouseDown);\n\t\tdocument.addEventListener(\"scroll\", onClose);\n\t\tdocument.addEventListener(\"keydown\", handleKeyDown);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"mousedown\", handleMouseDown);\n\t\t\tdocument.removeEventListener(\"scroll\", onClose);\n\t\t\tdocument.removeEventListener(\"keydown\", handleKeyDown);\n\t\t};\n\t}, [isOpen, onClose]);\n\n\treturn ref;\n};\n\nconst MenuItems: React.FC<{\n\titems: ContextMenuItem[];\n\tonItemClick: (item: ContextMenuItem) => void;\n}> = ({ items, onItemClick }) => (\n\t<div className=\"py-1\">\n\t\t{items.map((item, index) => (\n\t\t\t<React.Fragment key={index}>\n\t\t\t\t{item.separator && <div className=\"my-1 h-px bg-white/20\" />}\n\t\t\t\t<button\n\t\t\t\t\tonClick={() => onItemClick(item)}\n\t\t\t\t\tdisabled={item.disabled}\n\t\t\t\t\tclassName={twMerge(\n\t\t\t\t\t\tMENU_STYLES.menuItem,\n\t\t\t\t\t\titem.disabled\n\t\t\t\t\t\t\t? MENU_STYLES.menuItemDisabled\n\t\t\t\t\t\t\t: MENU_STYLES.menuItemEnabled,\n\t\t\t\t\t)}\n\t\t\t\t>\n\t\t\t\t\t<span>{item.label}</span>\n\t\t\t\t\t{item.shortcut && (\n\t\t\t\t\t\t<span className=\"ml-auto text-xs tracking-widest text-white/60\">\n\t\t\t\t\t\t\t{item.shortcut}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t)}\n\t\t\t\t</button>\n\t\t\t</React.Fragment>\n\t\t))}\n\t</div>\n);\n\nexport function ContextMenu({\n\tchildren,\n\titems,\n\tclassName = \"\",\n\ttrigger = \"contextmenu\",\n}: ContextMenuProps) {\n\tconst [isOpen, setIsOpen] = useState(false);\n\tconst [position, setPosition] = useState({ x: 0, y: 0 });\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\tconst getMenuPosition = useMenuPosition();\n\tconst menuRef = useClickOutside(isOpen, () => setIsOpen(false));\n\n\tconst handleContextMenu = useCallback(\n\t\t(event: React.MouseEvent) => {\n\t\t\tif (trigger !== \"contextmenu\") return;\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\tconst newPosition = getMenuPosition(\n\t\t\t\tevent.clientX,\n\t\t\t\tevent.clientY,\n\t\t\t\titems.length,\n\t\t\t);\n\t\t\tsetPosition(newPosition);\n\t\t\tsetIsOpen(true);\n\t\t},\n\t\t[trigger, getMenuPosition, items.length],\n\t);\n\n\tconst handleClick = useCallback(\n\t\t(event: React.MouseEvent) => {\n\t\t\tif (trigger !== \"click\") return;\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t\tsetIsOpen((prev) => !prev);\n\t\t},\n\t\t[trigger],\n\t);\n\n\tconst handleItemClick = useCallback((item: ContextMenuItem) => {\n\t\tif (!item.disabled) {\n\t\t\titem.onClick();\n\t\t\tsetIsOpen(false);\n\t\t}\n\t}, []);\n\n\tconst containerClasses = twMerge(\n\t\t\"flex flex-row items-center gap-[8px] hover:cursor-pointer text-sm transition-colors duration-150 rounded text-foreground/90 hover:text-primary hover:bg-foreground/5\",\n\t\tclassName,\n\t\ttrigger === \"click\" ? \"relative py-2 px-4\" : \"\",\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t<div\n\t\t\t\tref={containerRef}\n\t\t\t\tonContextMenu={handleContextMenu}\n\t\t\t\tonClick={handleClick}\n\t\t\t\tclassName={containerClasses}\n\t\t\t>\n\t\t\t\t{children}\n\t\t\t</div>\n\n\t\t\t{isOpen && (\n\t\t\t\t<>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"fixed inset-0 z-40\"\n\t\t\t\t\t\tstyle={{ backgroundColor: \"transparent\" }}\n\t\t\t\t\t/>\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tref={menuRef}\n\t\t\t\t\t\tclassName={twMerge(\n\t\t\t\t\t\t\tMENU_STYLES.base,\n\t\t\t\t\t\t\ttrigger === \"contextmenu\"\n\t\t\t\t\t\t\t\t? MENU_STYLES.contextMenu\n\t\t\t\t\t\t\t\t: MENU_STYLES.clickMenu,\n\t\t\t\t\t\t\ttrigger === \"click\" &&\n\t\t\t\t\t\t\t\t(isOpen\n\t\t\t\t\t\t\t\t\t? \"opacity-100 translate-y-1 pointer-events-auto\"\n\t\t\t\t\t\t\t\t\t: \"opacity-0 -translate-y-1 pointer-events-none\"),\n\t\t\t\t\t\t)}\n\t\t\t\t\t\tstyle={\n\t\t\t\t\t\t\ttrigger === \"contextmenu\"\n\t\t\t\t\t\t\t\t? { left: position.x, top: position.y }\n\t\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t\t}\n\t\t\t\t\t>\n\t\t\t\t\t\t<MenuItems items={items} onItemClick={handleItemClick} />\n\t\t\t\t\t</div>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</>\n\t);\n}\n\nexport function ContextMenuFlat({\n\tchildren,\n\titems,\n\tclassName = \"\",\n\ttrigger = \"click\",\n}: {\n\tchildren: React.ReactNode;\n\titems: ContextMenuItem[];\n\tclassName?: string;\n\ttrigger?: \"contextmenu\" | \"click\";\n}) {\n\tconst pathname = usePathname();\n\tconst [open, setOpen] = useState(false);\n\tconst containerRef = useRef<HTMLDivElement>(null);\n\n\tconst closeMenu = useCallback(() => setOpen(false), []);\n\n\tuseEffect(() => {\n\t\tconst handleMouseDown = (e: MouseEvent) => {\n\t\t\tif (\n\t\t\t\tcontainerRef.current &&\n\t\t\t\t!containerRef.current.contains(e.target as Node)\n\t\t\t) {\n\t\t\t\tcloseMenu();\n\t\t\t}\n\t\t};\n\n\t\tconst handleKeyDown = (e: KeyboardEvent) => {\n\t\t\tif (e.key === \"Escape\") closeMenu();\n\t\t};\n\n\t\tdocument.addEventListener(\"mousedown\", handleMouseDown);\n\t\tdocument.addEventListener(\"keydown\", handleKeyDown);\n\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(\"mousedown\", handleMouseDown);\n\t\t\tdocument.removeEventListener(\"keydown\", handleKeyDown);\n\t\t};\n\t}, [closeMenu]);\n\n\tconst isActive = useCallback(\n\t\t(href: string) => {\n\t\t\tconst base = href.split(\"#\")[0] || \"/\";\n\t\t\treturn base === \"/\"\n\t\t\t\t? pathname === \"/\"\n\t\t\t\t: pathname === base || pathname.startsWith(base + \"/\");\n\t\t},\n\t\t[pathname],\n\t);\n\n\tconst handleTrigger = useCallback(\n\t\t(e: React.MouseEvent, triggerType: string) => {\n\t\t\tif (trigger !== triggerType) return;\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tsetOpen((prev) => !prev);\n\t\t},\n\t\t[trigger],\n\t);\n\n\tconst handleBlur = useCallback(\n\t\t(e: React.FocusEvent) => {\n\t\t\tconst next = e.relatedTarget as Node | null;\n\t\t\tif (!(next && containerRef.current?.contains(next))) {\n\t\t\t\tcloseMenu();\n\t\t\t}\n\t\t},\n\t\t[closeMenu],\n\t);\n\n\treturn (\n\t\t<div\n\t\t\tref={containerRef}\n\t\t\tclassName={`relative inline-block ${className}`}\n\t\t\tonContextMenu={(e) => handleTrigger(e, \"contextmenu\")}\n\t\t\tonBlur={handleBlur}\n\t\t>\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\taria-haspopup=\"menu\"\n\t\t\t\taria-expanded={open}\n\t\t\t\tclassName={twMerge(\n\t\t\t\t\t\"text-sm text-foreground/90 hover:text-primary hover:bg-foreground/5 transition-colors duration-150 inline-flex items-center gap-1 rounded focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-foreground/30\",\n\t\t\t\t\ttrigger === \"click\" ? \"px-4 py-2\" : \"\",\n\t\t\t\t)}\n\t\t\t\tonClick={(e) => handleTrigger(e, \"click\")}\n\t\t\t>\n\t\t\t\t{children}\n\t\t\t</button>\n\n\t\t\t<div\n\t\t\t\trole=\"menu\"\n\t\t\t\tclassName={twMerge(\n\t\t\t\t\t\"absolute left-0 top-full z-60 w-56 rounded-md bg-background/95 p-1 shadow-lg backdrop-blur transition-all duration-150 ease-out hover:cursor-pointer\",\n\t\t\t\t\topen\n\t\t\t\t\t\t? \"opacity-100 translate-y-1 pointer-events-auto\"\n\t\t\t\t\t\t: \"opacity-0 -translate-y-1 pointer-events-none\",\n\t\t\t\t)}\n\t\t\t\tstyle={{ boxShadow: \"0px 4px 12px 4px #cccccc14\" }}\n\t\t\t>\n\t\t\t\t<nav className=\"flex flex-col items-start\">\n\t\t\t\t\t{items.map((item, index) => {\n\t\t\t\t\t\tconst href = (item as unknown as { href?: string })?.href;\n\t\t\t\t\t\tconst active = href ? isActive(href) : false;\n\t\t\t\t\t\tconst disabled = item.disabled;\n\n\t\t\t\t\t\tconst handleItemClick = () => {\n\t\t\t\t\t\t\tif (!disabled) {\n\t\t\t\t\t\t\t\titem.onClick?.();\n\t\t\t\t\t\t\t\tcloseMenu();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tconst itemClasses = twMerge(\n\t\t\t\t\t\t\t\"w-full text-left rounded px-2 py-1.5 text-sm transition-colors duration-150 whitespace-nowrap flex items-center justify-between\",\n\t\t\t\t\t\t\tdisabled\n\t\t\t\t\t\t\t\t? \"text-foreground/40 cursor-not-allowed\"\n\t\t\t\t\t\t\t\t: active\n\t\t\t\t\t\t\t\t\t? \"font-medium text-primary/70 bg-foreground/5\"\n\t\t\t\t\t\t\t\t\t: \"text-foreground/90 hover:bg-foreground/5 hover:text-primary\",\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\trole=\"menuitem\"\n\t\t\t\t\t\t\t\tonClick={handleItemClick}\n\t\t\t\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\t\t\t\tclassName={itemClasses}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span>{item.label}</span>\n\t\t\t\t\t\t\t\t{item.shortcut && (\n\t\t\t\t\t\t\t\t\t<span className=\"ml-auto text-xs tracking-widest text-foreground/60\">\n\t\t\t\t\t\t\t\t\t\t{item.shortcut}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t);\n\t\t\t\t\t})}\n\t\t\t\t</nav>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nexport default ContextMenu;\n"
    }
  ]
}