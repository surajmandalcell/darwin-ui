{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "upload",
  "type": "registry:ui",
  "title": "Upload",
  "description": "File upload component with drag-and-drop support and file validation.",
  "dependencies": [
    "lucide-react"
  ],
  "registryDependencies": [
    "utils"
  ],
  "files": [
    {
      "path": "components/upload.tsx",
      "type": "registry:ui",
      "content": "\"use client\";\n\nimport {\n\tArrowLeftRight as ArrowLeftRightIcon,\n\tImage as ImageIcon,\n\tStar as StarIcon,\n\tStarOff as StarOffIcon,\n\tTrash2 as Trash2Icon,\n\tUpload as UploadIcon,\n\tX as XIcon,\n} from \"lucide-react\";\nimport React from \"react\";\nimport { Button } from \"./button\";\nimport { Image } from \"./image\";\n\ninterface UploadProps {\n\tvalue: string[];\n\tonChange: (urls: string[]) => void;\n\tonUpload: (\n\t\tfiles: File[],\n\t\tonProgress?: (index: number, percent: number) => void,\n\t) => Promise<string[]>;\n\tmaxFiles?: number;\n\tlabel?: string;\n}\n\nexport function Upload({\n\tvalue,\n\tonChange,\n\tonUpload,\n\tmaxFiles = 6,\n\tlabel,\n}: UploadProps) {\n\tconst [errors, setErrors] = React.useState<string[]>([]);\n\tconst fileInputRef = React.useRef<HTMLInputElement | null>(null);\n\tconst [pending, setPending] = React.useState<\n\t\t{ id: string; preview: string; progress: number }[]\n\t>([]);\n\n\tfunction removeAt(index: number) {\n\t\tconst next = (value || []).filter((_, i) => i !== index);\n\t\tonChange(next);\n\t}\n\n\tfunction setCover(index: number) {\n\t\tif (index === 0) return;\n\t\tconst next = [...(value || [])];\n\t\tconst [picked] = next.splice(index, 1);\n\t\tnext.unshift(picked);\n\t\tonChange(next);\n\t}\n\n\tfunction swap(i: number, j: number) {\n\t\tconst next = [...(value || [])];\n\t\tif (i < 0 || j < 0 || i >= next.length || j >= next.length) return;\n\t\t[next[i], next[j]] = [next[j], next[i]];\n\t\tonChange(next);\n\t}\n\n\treturn (\n\t\t<div className=\"flex flex-col gap-2\">\n\t\t\t{/* Drop area */}\n\t\t\t<div className=\"relative flex min-h-52 flex-col overflow-hidden rounded-xl border border-dashed border-white/15 p-4\">\n\t\t\t\t{(value?.length || 0) + (pending.length || 0) > 0 ? (\n\t\t\t\t\t<div className=\"flex w-full flex-col gap-3\">\n\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t<h3 className=\"truncate text-sm font-medium text-white/80\">\n\t\t\t\t\t\t\t\tImages ({value.length + pending.length})\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tonClick={() => fileInputRef.current?.click()}\n\t\t\t\t\t\t\t\t\tclassName=\"inline-flex items-center gap-1.5 px-3 py-1.5 bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/20 rounded-md text-xs text-white/70 hover:text-white/90 transition-all duration-200\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<UploadIcon className=\"size-3.5\" />\n\t\t\t\t\t\t\t\t\tAdd\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tonClick={() => onChange([])}\n\t\t\t\t\t\t\t\t\tclassName=\"inline-flex items-center gap-1.5 px-3 py-1.5 bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 hover:border-red-500/30 rounded-md text-xs text-red-300 hover:text-red-200 transition-all duration-200\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Trash2Icon className=\"size-3.5\" />\n\t\t\t\t\t\t\t\t\tRemove all\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4 md:grid-cols-3 lg:grid-cols-4\">\n\t\t\t\t\t\t\t{value.map((url, index) => (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tkey={url + index}\n\t\t\t\t\t\t\t\t\tclassName=\"relative flex flex-col rounded-md border border-white/10 bg-white/5 overflow-hidden group\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\theight={80}\n\t\t\t\t\t\t\t\t\t\twidth={82}\n\t\t\t\t\t\t\t\t\t\tsrc={url}\n\t\t\t\t\t\t\t\t\t\talt={`Image ${index + 1}`}\n\t\t\t\t\t\t\t\t\t\tclassName=\"object-cover w-full max-h-20\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tonClick={() => removeAt(index)}\n\t\t\t\t\t\t\t\t\t\tclassName=\"border-background focus-visible:border-background absolute top-0 right-0 size-6 rounded-full shadow-none bg-red-500 hover:bg-red-600 flex items-center justify-center p-0\"\n\t\t\t\t\t\t\t\t\t\taria-label=\"Remove image\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<XIcon className=\"size-3.5 text-white\" />\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t<div className=\"flex min-w-0 items-center justify-between gap-2 border-t border-white/10 p-2\">\n\t\t\t\t\t\t\t\t\t\t<span className=\"truncate text-[12px] text-white/80\">\n\t\t\t\t\t\t\t\t\t\t\t{index === 0 ? \"Cover\" : `Image ${index + 1}`}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex gap-1\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\ttitle={index === 0 ? \"Already cover\" : \"Make cover\"}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setCover(index)}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"p-1 rounded bg-white/10 hover:bg-white/20 text-white\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{index === 0 ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<StarIcon className=\"w-3.5 h-3.5 text-yellow-300\" />\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<StarOffIcon className=\"w-3.5 h-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Swap with next\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\tswap(index, Math.min(index + 1, value.length - 1))\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"p-1 rounded bg-white/10 hover:bg-white/20 text-white\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<ArrowLeftRightIcon className=\"w-3.5 h-3.5\" />\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t{pending.map((p, i) => (\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tkey={\"pending-\" + p.id}\n\t\t\t\t\t\t\t\t\tclassName=\"relative flex flex-col rounded-md border border-white/10 bg-white/5 overflow-hidden\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div className=\"aspect-square w-full bg-black/30\">\n\t\t\t\t\t\t\t\t\t\t{/* eslint-disable-next-line @next/next/no-img-element */}\n\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\tsrc={p.preview}\n\t\t\t\t\t\t\t\t\t\t\talt={`Pending ${i + 1}`}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-full w-full object-cover opacity-80\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"absolute inset-x-0 bottom-0 p-2\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"h-1.5 w-full bg-black/40 rounded-full overflow-hidden\">\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-full bg-blue-500 rounded-full transition-all\"\n\t\t\t\t\t\t\t\t\t\t\t\tstyle={{ width: `${p.progress}%` }}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-[11px] text-white/70 mt-1\">\n\t\t\t\t\t\t\t\t\t\t\tUploadingâ€¦ {p.progress}%\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t) : (\n\t\t\t\t\t<div className=\"flex flex-col items-center justify-center px-4 py-3 text-center\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"mb-2 flex size-11 shrink-0 items-center justify-center rounded-full border border-white/15 bg-white/5\"\n\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<ImageIcon className=\"size-4 text-white/70\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p className=\"mb-1.5 text-sm font-medium text-white/90\">\n\t\t\t\t\t\t\tDrop your images here\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t{label && <p className=\"text-xs text-white/70 mb-1\">{label}</p>}\n\t\t\t\t\t\t<p className=\"text-xs text-white/60\">Max {maxFiles} files</p>\n\t\t\t\t\t\t<div className=\"mt-3\" />\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t<div className=\"py-3 px-0\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tref={fileInputRef}\n\t\t\t\t\t\ttype=\"file\"\n\t\t\t\t\t\taccept=\"image/*\"\n\t\t\t\t\t\tmultiple\n\t\t\t\t\t\tclassName=\"sr-only\"\n\t\t\t\t\t\tonChange={async (e) => {\n\t\t\t\t\t\t\tconst input = e.currentTarget;\n\t\t\t\t\t\t\tconst files = input.files;\n\t\t\t\t\t\t\tif (!files || files.length === 0) return;\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst picked = Array.from(files).slice(\n\t\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\t\tMath.max(0, maxFiles - (value?.length || 0)),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tconst local = picked.map((f, i) => ({\n\t\t\t\t\t\t\t\t\tid: f.name + \"-\" + Date.now() + \"-\" + i,\n\t\t\t\t\t\t\t\t\tpreview: URL.createObjectURL(f),\n\t\t\t\t\t\t\t\t\tprogress: 1,\n\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t\tsetPending((prev) => [...prev, ...local]);\n\t\t\t\t\t\t\t\tconst urls = await onUpload(\n\t\t\t\t\t\t\t\t\tpicked,\n\t\t\t\t\t\t\t\t\t(index: number, percent: number) => {\n\t\t\t\t\t\t\t\t\t\tsetPending((prev) => {\n\t\t\t\t\t\t\t\t\t\t\tconst copy = prev.slice();\n\t\t\t\t\t\t\t\t\t\t\tconst start = prev.length - local.length;\n\t\t\t\t\t\t\t\t\t\t\tconst idx = start + index;\n\t\t\t\t\t\t\t\t\t\t\tif (copy[idx]) copy[idx].progress = Math.max(1, percent);\n\t\t\t\t\t\t\t\t\t\t\treturn copy;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tlocal.forEach((l) => URL.revokeObjectURL(l.preview));\n\t\t\t\t\t\t\t\tsetPending((prev) =>\n\t\t\t\t\t\t\t\t\tprev.filter((p) => !local.some((l) => l.id === p.id)),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tif (urls?.length)\n\t\t\t\t\t\t\t\t\tonChange([...(value || []), ...urls].slice(0, maxFiles));\n\t\t\t\t\t\t\t} catch (e: any) {\n\t\t\t\t\t\t\t\tsetErrors([e?.message || \"Upload failed\"]);\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\tinput.value = \"\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclassName=\"border border-dashed border-white/50 rounded-lg min-h-[50px] flex items-center justify-center text-white/60 text-sm cursor-pointer hover:bg-white/5\"\n\t\t\t\t\t\tonClick={() => fileInputRef.current?.click()}\n\t\t\t\t\t>\n\t\t\t\t\t\tClick to select images\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{errors.length > 0 && (\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"flex items-center gap-1 text-xs text-red-300\"\n\t\t\t\t\trole=\"alert\"\n\t\t\t\t>\n\t\t\t\t\t<span>{errors[0]}</span>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n"
    }
  ]
}